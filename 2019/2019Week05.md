# Week 05

> January 28 to February 3

## Algorithm：

## Review：

## Tip：
### defer
`defer` 关键字只在表达式离开作用域时运行，通过一个 `block` 使得这种方法安全且简洁。  
比如：
```swift
func currentHostName() -> String {
    let capacity = Int(NI_MAXHOST)
    let buffer = UnsafeMutablePointer<Int8>.allocate(capacity: capacity)

    guard gethostname(buffer, capacity) == 0 else {
        buffer.deallocate()
        return "localhost"
    }

    let hostname = String(cString: buffer)
    buffer.deallocate()

    return hostname
}
```
`buffer` 每次都需要 `deallocate`，这样代码不简洁
```swift
func currentHostName() -> String {
    let capacity = Int(NI_MAXHOST)
    let buffer = UnsafeMutablePointer<Int8>.allocate(capacity: capacity)
    defer { buffer.deallocate() }

    guard gethostname(buffer, capacity) == 0 else {
        return "localhost"
    }

    return String(cString: buffer)
}
```
使用 `defer` 可以保证 `return` 时 `buffer` 会被 `deallocate`  
`defer` 常用在一些需要成对出现的 `API` 中，比如 `allocate(capacity:) / deallocate()`， `wait() / signal()`， 或者 `open() / close()`。

## Share：