# Week 44

> November 5 to November 11

## Algorithm：


## Review：


## Tip：
在 `AutoLayout` 中使用 `CALayer`

### 方法一
通过重写 `UIView` 的 `+ (Class)layerClass` 自定义 `CALayer`。
```objc
@implementation PlayerView
+ (Class)layerClass {
    return [AVPlayerLayer class];
}
@end
```

在实际中用的时候就可以直接添加
```objc
playerView = [PlayerView new];
AVPlayer *player = [[AVPlayer alloc] initWithPlayerItem:playItem];
[(AVPlayerLayer *)playerView.layer setPlayer:player];
```

### 方法二
通过 `block` 回调 `UIView` 的 `layoutSubviews`，这样就可以很灵活的布局 `CALayer` 了。

```objc
@@implementation UIView (LayoutSubviewsCallback)
+ (void)load {
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        Method originalMethod = class_getInstanceMethod(self, @selector(layoutSubviews));
        Method newMethod = class_getInstanceMethod(self, @selector(ls_layoutSubviews));
        
        BOOL didAddMethod = class_addMethod(self, @selector(layoutSubviews), method_getImplementation(newMethod), method_getTypeEncoding(newMethod));
        if (didAddMethod) {
            class_replaceMethod(self, @selector(ls_layoutSubviews), method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod));
        } else {
            method_exchangeImplementations(originalMethod, newMethod);
        }
    });
}

- (void)ls_layoutSubviews {
    [self ls_layoutSubviews];
    
    if (self.layoutSubviewsCallback) {
        self.layoutSubviewsCallback(self);
    }
}

- (void)setLayoutSubviewsCallback:(void (^)(UIView *))layoutSubviewsCallback {
    objc_setAssociatedObject(self, "layoutSubviewsCallback", layoutSubviewsCallback, OBJC_ASSOCIATION_RETAIN);
}

- (void (^)(UIView *))layoutSubviewsCallback {
    return objc_getAssociatedObject(self, "layoutSubviewsCallback");
}
@end
```

外部使用：
```objc
AVPlayerLayer *avLayer = [AVPlayerLayer new];
[playerView.layer addSublayer:avLayer];
playerView.layoutSubviewsCallback = ^(UIView *view) {
    avLayer.frame = view.bounds;
};
```

### 方法三
直接在 `viewDidLayoutSubviews` 中设置
```
- (void)viewDidLayoutSubviews {
    [super viewDidLayoutSubviews];
    avLayer.frame = self.view.frame;
}
```

## Share：